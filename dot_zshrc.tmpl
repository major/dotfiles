# Enable Powerlevel10k instant prompt. Should stay close to the top of ~/.zshrc.
# Initialization code that may require console input (password prompts, [y/n]
# confirmations, etc.) must go above this block; everything else may go below.
if [[ -r "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh" ]]; then
  source "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh"
fi

# oh-my-zsh config
export ZSH="$HOME/.oh-my-zsh"
ZSH_THEME="powerlevel10k/powerlevel10k"
plugins=(
        # Core functionality
        colored-man-pages
        docker
        fzf
        gh
        git
        podman
        sudo
        z
        zsh-autosuggestions
        zsh-syntax-highlighting

        # Utilities
        copybuffer
        copypath
        extract
        uv
)
source $ZSH/oh-my-zsh.sh

export PATH=$HOME/.local/bin:$HOME/.cargo/bin:$HOME/bin:/usr/local/bin:$PATH

# favorite editor
export EDITOR=vim

# configure history
setopt share_history
setopt EXTENDED_HISTORY
setopt HIST_FIND_NO_DUPS
setopt HIST_IGNORE_ALL_DUPS    # Remove older duplicate entries
setopt HIST_REDUCE_BLANKS      # Remove superfluous blanks
setopt HIST_VERIFY             # Don't execute immediately on history expansion
setopt INC_APPEND_HISTORY      # Write immediately, not on shell exit
export HISTTIMEFORMAT="[%F %T] "
export HISTFILESIZE=1000000000
export HISTSIZE=1000000000

# use the ssh-agent started by systemd.
export SSH_AUTH_SOCK=~/.1password/agent.sock

# ensure gpg works properly in each terminal.
export GPG_TTY="$(tty)"

# Speedups.
export TZ=America/Chicago

# This seems to break emojis in terminals. ðŸ¤” ðŸ˜¢
#export LC_ALL=C

# Lazy-load pyenv for faster shell startup
export PYENV_ROOT="$HOME/.pyenv"
[[ -d $PYENV_ROOT/bin ]] && export PATH="$PYENV_ROOT/bin:$PATH"
if command -v pyenv &>/dev/null; then
  pyenv() {
    unfunction pyenv python python3 pip pip3 2>/dev/null
    eval "$(command pyenv init -)"
    pyenv "$@"
  }
  python() { unfunction python; eval "$(command pyenv init -)"; python "$@" }
  python3() { unfunction python3; eval "$(command pyenv init -)"; python3 "$@" }
  pip() { unfunction pip; eval "$(command pyenv init -)"; pip "$@" }
  pip3() { unfunction pip3; eval "$(command pyenv init -)"; pip3 "$@" }
fi

# To customize prompt, run `p10k configure` or edit ~/.p10k.zsh.
[[ ! -f ~/.p10k.zsh ]] || source ~/.p10k.zsh

export FLYCTL_INSTALL="/home/major/.fly"
export PATH="$FLYCTL_INSTALL/bin:$PATH"

# Lazy-load rbenv for faster shell startup
if command -v rbenv &>/dev/null; then
  rbenv() {
    unfunction rbenv ruby gem bundle 2>/dev/null
    eval "$(command rbenv init - --no-rehash zsh)"
    rbenv "$@"
  }
  ruby() { unfunction ruby; eval "$(command rbenv init - --no-rehash zsh)"; ruby "$@" }
  gem() { unfunction gem; eval "$(command rbenv init - --no-rehash zsh)"; gem "$@" }
  bundle() { unfunction bundle; eval "$(command rbenv init - --no-rehash zsh)"; bundle "$@" }
fi
export PATH=~/.npm-global/bin:$PATH

#source /home/major/.config/op/plugins.sh

# Keypad
# 0 . Enter
bindkey -s "^[Op" "0"
bindkey -s "^[Ol" "."
bindkey -s "^[OM" "^M"
# 1 2 3
bindkey -s "^[Oq" "1"
bindkey -s "^[Or" "2"
bindkey -s "^[Os" "3"
# 4 5 6
bindkey -s "^[Ot" "4"
bindkey -s "^[Ou" "5"
bindkey -s "^[Ov" "6"
# 7 8 9
bindkey -s "^[Ow" "7"
bindkey -s "^[Ox" "8"
bindkey -s "^[Oy" "9"
# + -  * /
bindkey -s "^[Ok" "+"
bindkey -s "^[Om" "-"
bindkey -s "^[Oj" "*"
bindkey -s "^[Oo" "/"


# The next line updates PATH for the Google Cloud SDK.
if [ -f '/home/major/Downloads/google-cloud-cli-linux-x86_64/google-cloud-sdk/path.zsh.inc' ]; then . '/home/major/Downloads/google-cloud-cli-linux-x86_64/google-cloud-sdk/path.zsh.inc'; fi

# The next line enables shell command completion for gcloud.
if [ -f '/home/major/Downloads/google-cloud-cli-linux-x86_64/google-cloud-sdk/completion.zsh.inc' ]; then . '/home/major/Downloads/google-cloud-cli-linux-x86_64/google-cloud-sdk/completion.zsh.inc'; fi

# Source machine-local secrets/config (not tracked in dotfiles)
[[ -f ~/.zshrc.local ]] && source ~/.zshrc.local

# opencode
export OPENCODE_DISABLE_CLAUDE_CODE=1
export PATH=/home/major/.opencode/bin:$PATH
